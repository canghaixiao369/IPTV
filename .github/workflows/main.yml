name: itvlist

on:
  push:
  schedule:
    - cron:  '30 23 * * *'    # 国际标准时间早上7点30
  

jobs:
  build:
    runs-on: ubuntu-latest
    #runs-on: ubuntu-22.04@20240422.1.0

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
    
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.12.3'

      - name: Install dependencies
        #run: pip install selenium==4.19.0 requests==2.31.0 futures==3.0.5 eventlet==0.36.1
        run: pip install selenium requests futures eventlet aiohttp aiofiles

      #- name: Run itv_all
        #run: python ${{ github.workspace }}/itv_all.py

      - name: Run cctv
        run: python ${{ github.workspace }}/new.py
        
      #- name: Run weishi
        #run: python ${{ github.workspace }}/weishi.py
        
      #- name: Run qita
        #run: python ${{ github.workspace }}/qita.py
        
      - name: 提交更改
run: |
  git config --local user.email "772109739@qq.com"
  git config --local user.name "canghaixiao"
  git add .
  git commit *.txt -m "Add generated file"
  git commit *.m3u -m "Add generated file"
  #git pull --rebase
  git push -f

  # 获取最新的提交哈希
  COMMIT_HASH=$(git rev-parse HEAD)

  # 假设你的仓库是 public 的，并且文件在根目录下
  TXT_FILE_LINK="https://ghcy.eu.org/https://raw.githubusercontent.com/canghaixiao369/IPTV/$COMMIT_HASH/itvlist.txt"
  M3U_FILE_LINK="https://ghcy.eu.org/https://raw.githubusercontent.com/canghaixiao369/IPTV/$COMMIT_HASH/itvlist.m3u"

  # 发送邮件
  echo -e "生成的txt文件链接: $TXT_FILE_LINK\n生成的m3u文件链接: $M3U_FILE_LINK" | mail -s "文件链接" 772109739@qq.com
